package trainticket_twostage_test.TrainTicketTwoStageTest_1754947904519;

import io.restassured.RestAssured;
import io.restassured.response.Response;
import io.restassured.specification.RequestSpecification;
import org.junit.BeforeClass;
import org.junit.Test;
import org.junit.AssumptionViolatedException;
import java.util.concurrent.atomic.AtomicBoolean;
import java.util.Map;
import static org.junit.Assert.*;
import es.us.isa.restest.testcases.MultiServiceTestCase;
import io.qameta.allure.Allure;
import io.qameta.allure.restassured.AllureRestAssured;
import io.qameta.allure.model.Status;

public class POST_api_v1_adminrouteservice_adminroute_1 {

    @BeforeClass
    public static void setupRestAssured() {
        RestAssured.baseURI = "http://129.62.148.112:32677";
        // Configure Allure results directory
        System.setProperty("allure.results.directory", "target/allure-results");
        RestAssured.filters(new AllureRestAssured());
    }

    @Test
    public void test_POST_1_1() throws Exception {
        final String[] _jwt     = new String[1];
        final String[] _jwtType = new String[1];
        final java.util.concurrent.atomic.AtomicBoolean loginSucceeded  = new java.util.concurrent.atomic.AtomicBoolean(true);
        final java.util.concurrent.atomic.AtomicBoolean scenarioFailed = new java.util.concurrent.atomic.AtomicBoolean(false);
        // ğŸ” STEP 0: Authentication - Clean reporting
        Allure.step("ğŸ” Step 0: Authentication (Login)", () -> {
            try {
                Allure.parameter("ğŸ¢ Service", "Authentication Service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/users/login");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ‘¤ Username", "admin");
                Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - Authentication required");
                Allure.description("ğŸ” **Authentication Step**\n" +
                                 "This step authenticates the user to obtain JWT token for subsequent API calls.\n" +
                                 "All other steps depend on successful authentication.");
                
                Response loginRes = RestAssured.given()
                    .contentType("application/json")
                    .body("{\"username\":\"admin\",\"password\":\"222222\"}")
                .when().post("/api/v1/users/login")
                    .then().log().ifValidationFails()
                    .statusCode(200)  // Login expects 200 - could be configurable in future
                    .extract().response();
                _jwt[0]     = loginRes.jsonPath().getString("data.token");
                _jwtType[0] = "Bearer";
                
                // âœ… SUCCESS: Clean login success reporting
                String tokenObtained = _jwt[0] != null ? "Yes" : "No";
                Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (Token: " + tokenObtained + ")");
                Allure.addAttachment("ğŸ” Login Response", "application/json", loginRes.getBody().asString());
            } catch (Throwable loginError) {
                loginSucceeded.set(false);
                
                // âŒ FAILURE: Clean login failure reporting
                String errorType = loginError.getClass().getSimpleName();
                if (loginError instanceof java.net.ConnectException) {
                    errorType = "Connection Failed";
                } else if (loginError instanceof AssertionError) {
                    errorType = "Authentication Failed";
                }
                
                Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                Allure.addAttachment("ğŸ’¥ Login Error", "text/plain", "Error: " + errorType + "\nMessage: " + loginError.getMessage());
                
                // Throw to mark login step as failed in Allure
                throw new RuntimeException("Login failed: " + loginError.getMessage(), loginError);
            }
        });
        String jwt     = _jwt[0];
        String jwtType = _jwtType[0];

        // Step execution results tracking
        final java.util.Map<Integer, Boolean> stepResults = new java.util.HashMap<>();
        final java.util.Map<Integer, String> capturedOutputs = new java.util.HashMap<>();

        // Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-admin-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/adminrouteservice/adminroute");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-admin-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/adminrouteservice/adminroute\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody1 = "{\"distanceList\":\"1.\",\"distances\":\"[\\\"43.5\\\", \\\"1207.9\\\", \\\"7891.2\\\", \\\"3456.3\\\", \\\"2198.4\\\"]\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"loginId\":\"4d2a46c7-71cb-4cf1-5\",\"startStation\":\"wuxi\",\"stationList\":\"wuxi,shijiazhuang\",\"stations\":\"[\\\"wuxi\\\", \\\"shijiazhuang\\\"]\"}";
                        req = req.body(requestBody1);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody1);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse1 = req.when().post("/api/v1/adminrouteservice/adminroute")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(1, true);
                        System.out.println("âœ… Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse1.getBody().asString();
                            int actualStatus = stepResponse1.getStatusCode();
                            long responseTime = stepResponse1.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(1, false);
                        System.out.println("âŒ Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - " + skipReason);
                    stepResults.put(1, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 1 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 1 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200): " + stepException.getMessage());
                stepResults.put(1, false);
            }
        }

        // Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-station-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/stationservice/stations/idlist");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-station-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/stationservice/stations/idlist\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody2 = "[\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\"]";
                        req = req.body(requestBody2);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody2);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse2 = req.when().post("/api/v1/stationservice/stations/idlist")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(2, true);
                        System.out.println("âœ… Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse2.getBody().asString();
                            int actualStatus = stepResponse2.getStatusCode();
                            long responseTime = stepResponse2.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(2, false);
                        System.out.println("âŒ Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - " + skipReason);
                    stepResults.put(2, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 2 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 2 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200): " + stepException.getMessage());
                stepResults.put(2, false);
            }
        }

        // Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/routeservice/routes");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/routeservice/routes\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody3 = "{\"distanceList\":\"1.\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"startStation\":\"wuxi\",\"stationList\":\"wuxi,shijiazhuang\"}";
                        req = req.body(requestBody3);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody3);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse3 = req.when().post("/api/v1/routeservice/routes")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(3, true);
                        System.out.println("âœ… Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse3.getBody().asString();
                            int actualStatus = stepResponse3.getStatusCode();
                            long responseTime = stepResponse3.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(3, false);
                        System.out.println("âŒ Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - " + skipReason);
                    stepResults.put(3, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 3 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 3 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200): " + stepException.getMessage());
                stepResults.put(3, false);
            }
        }

        // Evaluate scenario result with comprehensive reporting
        long successfulSteps = stepResults.values().stream().filter(result -> result).count();
        long failedSteps = stepResults.values().stream().filter(result -> !result).count();
        long totalSteps = stepResults.size();
        
        // Add clean test summary - no duplicate content
        String overallResult;
        String severity;
        if (!loginSucceeded.get()) {
            overallResult = "âŒ AUTHENTICATION FAILED";
            severity = "critical";
        } else if (failedSteps == 0) {
            overallResult = "âœ… ALL STEPS PASSED";
            severity = "normal";
        } else if (successfulSteps > 0) {
            overallResult = "âš ï¸ PARTIAL FAILURE";
            severity = "major";
        } else {
            overallResult = "âŒ ALL STEPS FAILED";
            severity = "critical";
        }
        
        // Single summary parameter with all key info
        Allure.parameter("ğŸ“Š Scenario Result", overallResult + " (" + successfulSteps + "/" + totalSteps + " steps)");
        
        // Add clean categorization
        Allure.label("severity", severity);
        Allure.label("feature", "Microservice Workflow");
        Allure.label("story", "test_POST_1_1");
        Allure.description("Microservice test scenario with " + totalSteps + " steps.");
        
        System.out.println("=== SCENARIO RESULT ===");
        System.out.println("Scenario: test_POST_1_1");
        System.out.println("Total Steps: " + totalSteps);
        System.out.println("Successful: " + successfulSteps);
        System.out.println("Failed: " + failedSteps);
        System.out.println("Login Status: " + (loginSucceeded.get() ? "SUCCESS" : "FAILED"));
        
        // IMPROVED: Test fails if ANY step fails or login fails (not just when ALL fail)
        if (!loginSucceeded.get()) {
            fail("Scenario FAILED: Authentication failed - cannot proceed with API calls");
        } else if (failedSteps > 0) {
            fail("Scenario FAILED: " + failedSteps + " out of " + totalSteps + " steps failed. " +
                 "In microservice testing, all workflow steps must succeed for end-to-end validation.");
        } else if (successfulSteps == 0) {
            fail("Scenario FAILED: No steps executed successfully - check service availability");
        } else {
            System.out.println("ğŸ‰ Scenario PASSED: All " + totalSteps + " steps completed successfully");
        }
    }

    @Test
    public void test_POST_1_2() throws Exception {
        final String[] _jwt     = new String[1];
        final String[] _jwtType = new String[1];
        final java.util.concurrent.atomic.AtomicBoolean loginSucceeded  = new java.util.concurrent.atomic.AtomicBoolean(true);
        final java.util.concurrent.atomic.AtomicBoolean scenarioFailed = new java.util.concurrent.atomic.AtomicBoolean(false);
        // ğŸ” STEP 0: Authentication - Clean reporting
        Allure.step("ğŸ” Step 0: Authentication (Login)", () -> {
            try {
                Allure.parameter("ğŸ¢ Service", "Authentication Service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/users/login");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ‘¤ Username", "admin");
                Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - Authentication required");
                Allure.description("ğŸ” **Authentication Step**\n" +
                                 "This step authenticates the user to obtain JWT token for subsequent API calls.\n" +
                                 "All other steps depend on successful authentication.");
                
                Response loginRes = RestAssured.given()
                    .contentType("application/json")
                    .body("{\"username\":\"admin\",\"password\":\"222222\"}")
                .when().post("/api/v1/users/login")
                    .then().log().ifValidationFails()
                    .statusCode(200)  // Login expects 200 - could be configurable in future
                    .extract().response();
                _jwt[0]     = loginRes.jsonPath().getString("data.token");
                _jwtType[0] = "Bearer";
                
                // âœ… SUCCESS: Clean login success reporting
                String tokenObtained = _jwt[0] != null ? "Yes" : "No";
                Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (Token: " + tokenObtained + ")");
                Allure.addAttachment("ğŸ” Login Response", "application/json", loginRes.getBody().asString());
            } catch (Throwable loginError) {
                loginSucceeded.set(false);
                
                // âŒ FAILURE: Clean login failure reporting
                String errorType = loginError.getClass().getSimpleName();
                if (loginError instanceof java.net.ConnectException) {
                    errorType = "Connection Failed";
                } else if (loginError instanceof AssertionError) {
                    errorType = "Authentication Failed";
                }
                
                Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                Allure.addAttachment("ğŸ’¥ Login Error", "text/plain", "Error: " + errorType + "\nMessage: " + loginError.getMessage());
                
                // Throw to mark login step as failed in Allure
                throw new RuntimeException("Login failed: " + loginError.getMessage(), loginError);
            }
        });
        String jwt     = _jwt[0];
        String jwtType = _jwtType[0];

        // Step execution results tracking
        final java.util.Map<Integer, Boolean> stepResults = new java.util.HashMap<>();
        final java.util.Map<Integer, String> capturedOutputs = new java.util.HashMap<>();

        // Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-admin-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/adminrouteservice/adminroute");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-admin-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/adminrouteservice/adminroute\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody1 = "{\"distanceList\":\"1.\",\"distances\":\"[\\\"43.5\\\", \\\"1207.9\\\", \\\"7891.2\\\", \\\"3456.3\\\", \\\"2198.4\\\"]\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"loginId\":\"fdse_microservice\",\"startStation\":\"nanjing\",\"stationList\":\"dallas\",\"stations\":\"[\\\"dallas\\\"]\"}";
                        req = req.body(requestBody1);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody1);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse1 = req.when().post("/api/v1/adminrouteservice/adminroute")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(1, true);
                        System.out.println("âœ… Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse1.getBody().asString();
                            int actualStatus = stepResponse1.getStatusCode();
                            long responseTime = stepResponse1.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(1, false);
                        System.out.println("âŒ Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - " + skipReason);
                    stepResults.put(1, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 1 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 1 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200): " + stepException.getMessage());
                stepResults.put(1, false);
            }
        }

        // Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-station-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/stationservice/stations/idlist");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-station-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/stationservice/stations/idlist\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody2 = "[\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\"]";
                        req = req.body(requestBody2);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody2);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse2 = req.when().post("/api/v1/stationservice/stations/idlist")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(2, true);
                        System.out.println("âœ… Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse2.getBody().asString();
                            int actualStatus = stepResponse2.getStatusCode();
                            long responseTime = stepResponse2.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(2, false);
                        System.out.println("âŒ Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - " + skipReason);
                    stepResults.put(2, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 2 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 2 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200): " + stepException.getMessage());
                stepResults.put(2, false);
            }
        }

        // Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/routeservice/routes");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/routeservice/routes\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody3 = "{\"distanceList\":\"1.\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"startStation\":\"nanjing\",\"stationList\":\"dallas\"}";
                        req = req.body(requestBody3);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody3);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse3 = req.when().post("/api/v1/routeservice/routes")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(3, true);
                        System.out.println("âœ… Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse3.getBody().asString();
                            int actualStatus = stepResponse3.getStatusCode();
                            long responseTime = stepResponse3.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(3, false);
                        System.out.println("âŒ Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - " + skipReason);
                    stepResults.put(3, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 3 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 3 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200): " + stepException.getMessage());
                stepResults.put(3, false);
            }
        }

        // Evaluate scenario result with comprehensive reporting
        long successfulSteps = stepResults.values().stream().filter(result -> result).count();
        long failedSteps = stepResults.values().stream().filter(result -> !result).count();
        long totalSteps = stepResults.size();
        
        // Add clean test summary - no duplicate content
        String overallResult;
        String severity;
        if (!loginSucceeded.get()) {
            overallResult = "âŒ AUTHENTICATION FAILED";
            severity = "critical";
        } else if (failedSteps == 0) {
            overallResult = "âœ… ALL STEPS PASSED";
            severity = "normal";
        } else if (successfulSteps > 0) {
            overallResult = "âš ï¸ PARTIAL FAILURE";
            severity = "major";
        } else {
            overallResult = "âŒ ALL STEPS FAILED";
            severity = "critical";
        }
        
        // Single summary parameter with all key info
        Allure.parameter("ğŸ“Š Scenario Result", overallResult + " (" + successfulSteps + "/" + totalSteps + " steps)");
        
        // Add clean categorization
        Allure.label("severity", severity);
        Allure.label("feature", "Microservice Workflow");
        Allure.label("story", "test_POST_1_2");
        Allure.description("Microservice test scenario with " + totalSteps + " steps.");
        
        System.out.println("=== SCENARIO RESULT ===");
        System.out.println("Scenario: test_POST_1_2");
        System.out.println("Total Steps: " + totalSteps);
        System.out.println("Successful: " + successfulSteps);
        System.out.println("Failed: " + failedSteps);
        System.out.println("Login Status: " + (loginSucceeded.get() ? "SUCCESS" : "FAILED"));
        
        // IMPROVED: Test fails if ANY step fails or login fails (not just when ALL fail)
        if (!loginSucceeded.get()) {
            fail("Scenario FAILED: Authentication failed - cannot proceed with API calls");
        } else if (failedSteps > 0) {
            fail("Scenario FAILED: " + failedSteps + " out of " + totalSteps + " steps failed. " +
                 "In microservice testing, all workflow steps must succeed for end-to-end validation.");
        } else if (successfulSteps == 0) {
            fail("Scenario FAILED: No steps executed successfully - check service availability");
        } else {
            System.out.println("ğŸ‰ Scenario PASSED: All " + totalSteps + " steps completed successfully");
        }
    }

    @Test
    public void test_POST_1_3() throws Exception {
        final String[] _jwt     = new String[1];
        final String[] _jwtType = new String[1];
        final java.util.concurrent.atomic.AtomicBoolean loginSucceeded  = new java.util.concurrent.atomic.AtomicBoolean(true);
        final java.util.concurrent.atomic.AtomicBoolean scenarioFailed = new java.util.concurrent.atomic.AtomicBoolean(false);
        // ğŸ” STEP 0: Authentication - Clean reporting
        Allure.step("ğŸ” Step 0: Authentication (Login)", () -> {
            try {
                Allure.parameter("ğŸ¢ Service", "Authentication Service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/users/login");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ‘¤ Username", "admin");
                Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - Authentication required");
                Allure.description("ğŸ” **Authentication Step**\n" +
                                 "This step authenticates the user to obtain JWT token for subsequent API calls.\n" +
                                 "All other steps depend on successful authentication.");
                
                Response loginRes = RestAssured.given()
                    .contentType("application/json")
                    .body("{\"username\":\"admin\",\"password\":\"222222\"}")
                .when().post("/api/v1/users/login")
                    .then().log().ifValidationFails()
                    .statusCode(200)  // Login expects 200 - could be configurable in future
                    .extract().response();
                _jwt[0]     = loginRes.jsonPath().getString("data.token");
                _jwtType[0] = "Bearer";
                
                // âœ… SUCCESS: Clean login success reporting
                String tokenObtained = _jwt[0] != null ? "Yes" : "No";
                Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (Token: " + tokenObtained + ")");
                Allure.addAttachment("ğŸ” Login Response", "application/json", loginRes.getBody().asString());
            } catch (Throwable loginError) {
                loginSucceeded.set(false);
                
                // âŒ FAILURE: Clean login failure reporting
                String errorType = loginError.getClass().getSimpleName();
                if (loginError instanceof java.net.ConnectException) {
                    errorType = "Connection Failed";
                } else if (loginError instanceof AssertionError) {
                    errorType = "Authentication Failed";
                }
                
                Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                Allure.addAttachment("ğŸ’¥ Login Error", "text/plain", "Error: " + errorType + "\nMessage: " + loginError.getMessage());
                
                // Throw to mark login step as failed in Allure
                throw new RuntimeException("Login failed: " + loginError.getMessage(), loginError);
            }
        });
        String jwt     = _jwt[0];
        String jwtType = _jwtType[0];

        // Step execution results tracking
        final java.util.Map<Integer, Boolean> stepResults = new java.util.HashMap<>();
        final java.util.Map<Integer, String> capturedOutputs = new java.util.HashMap<>();

        // Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-admin-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/adminrouteservice/adminroute");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-admin-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/adminrouteservice/adminroute\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody1 = "{\"distanceList\":\"1.\",\"distances\":\"[\\\"43.5\\\", \\\"1207.9\\\", \\\"7891.2\\\", \\\"3456.3\\\", \\\"2198.4\\\"]\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"loginId\":\"james123\",\"startStation\":\"waco\",\"stationList\":\"suzhou\",\"stations\":\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Ferry Building\\\", \\\"Washington Union Station\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\"]\"}";
                        req = req.body(requestBody1);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody1);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse1 = req.when().post("/api/v1/adminrouteservice/adminroute")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(1, true);
                        System.out.println("âœ… Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse1.getBody().asString();
                            int actualStatus = stepResponse1.getStatusCode();
                            long responseTime = stepResponse1.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(1, false);
                        System.out.println("âŒ Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - " + skipReason);
                    stepResults.put(1, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 1 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 1 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200): " + stepException.getMessage());
                stepResults.put(1, false);
            }
        }

        // Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-station-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/stationservice/stations/idlist");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-station-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/stationservice/stations/idlist\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody2 = "[\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\"]";
                        req = req.body(requestBody2);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody2);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse2 = req.when().post("/api/v1/stationservice/stations/idlist")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(2, true);
                        System.out.println("âœ… Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse2.getBody().asString();
                            int actualStatus = stepResponse2.getStatusCode();
                            long responseTime = stepResponse2.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(2, false);
                        System.out.println("âŒ Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - " + skipReason);
                    stepResults.put(2, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 2 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 2 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200): " + stepException.getMessage());
                stepResults.put(2, false);
            }
        }

        // Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/routeservice/routes");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/routeservice/routes\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody3 = "{\"distanceList\":\"1.\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"startStation\":\"waco\",\"stationList\":\"suzhou\"}";
                        req = req.body(requestBody3);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody3);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse3 = req.when().post("/api/v1/routeservice/routes")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(3, true);
                        System.out.println("âœ… Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse3.getBody().asString();
                            int actualStatus = stepResponse3.getStatusCode();
                            long responseTime = stepResponse3.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(3, false);
                        System.out.println("âŒ Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - " + skipReason);
                    stepResults.put(3, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 3 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 3 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200): " + stepException.getMessage());
                stepResults.put(3, false);
            }
        }

        // Evaluate scenario result with comprehensive reporting
        long successfulSteps = stepResults.values().stream().filter(result -> result).count();
        long failedSteps = stepResults.values().stream().filter(result -> !result).count();
        long totalSteps = stepResults.size();
        
        // Add clean test summary - no duplicate content
        String overallResult;
        String severity;
        if (!loginSucceeded.get()) {
            overallResult = "âŒ AUTHENTICATION FAILED";
            severity = "critical";
        } else if (failedSteps == 0) {
            overallResult = "âœ… ALL STEPS PASSED";
            severity = "normal";
        } else if (successfulSteps > 0) {
            overallResult = "âš ï¸ PARTIAL FAILURE";
            severity = "major";
        } else {
            overallResult = "âŒ ALL STEPS FAILED";
            severity = "critical";
        }
        
        // Single summary parameter with all key info
        Allure.parameter("ğŸ“Š Scenario Result", overallResult + " (" + successfulSteps + "/" + totalSteps + " steps)");
        
        // Add clean categorization
        Allure.label("severity", severity);
        Allure.label("feature", "Microservice Workflow");
        Allure.label("story", "test_POST_1_3");
        Allure.description("Microservice test scenario with " + totalSteps + " steps.");
        
        System.out.println("=== SCENARIO RESULT ===");
        System.out.println("Scenario: test_POST_1_3");
        System.out.println("Total Steps: " + totalSteps);
        System.out.println("Successful: " + successfulSteps);
        System.out.println("Failed: " + failedSteps);
        System.out.println("Login Status: " + (loginSucceeded.get() ? "SUCCESS" : "FAILED"));
        
        // IMPROVED: Test fails if ANY step fails or login fails (not just when ALL fail)
        if (!loginSucceeded.get()) {
            fail("Scenario FAILED: Authentication failed - cannot proceed with API calls");
        } else if (failedSteps > 0) {
            fail("Scenario FAILED: " + failedSteps + " out of " + totalSteps + " steps failed. " +
                 "In microservice testing, all workflow steps must succeed for end-to-end validation.");
        } else if (successfulSteps == 0) {
            fail("Scenario FAILED: No steps executed successfully - check service availability");
        } else {
            System.out.println("ğŸ‰ Scenario PASSED: All " + totalSteps + " steps completed successfully");
        }
    }

    @Test
    public void test_POST_1_4() throws Exception {
        final String[] _jwt     = new String[1];
        final String[] _jwtType = new String[1];
        final java.util.concurrent.atomic.AtomicBoolean loginSucceeded  = new java.util.concurrent.atomic.AtomicBoolean(true);
        final java.util.concurrent.atomic.AtomicBoolean scenarioFailed = new java.util.concurrent.atomic.AtomicBoolean(false);
        // ğŸ” STEP 0: Authentication - Clean reporting
        Allure.step("ğŸ” Step 0: Authentication (Login)", () -> {
            try {
                Allure.parameter("ğŸ¢ Service", "Authentication Service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/users/login");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ‘¤ Username", "admin");
                Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - Authentication required");
                Allure.description("ğŸ” **Authentication Step**\n" +
                                 "This step authenticates the user to obtain JWT token for subsequent API calls.\n" +
                                 "All other steps depend on successful authentication.");
                
                Response loginRes = RestAssured.given()
                    .contentType("application/json")
                    .body("{\"username\":\"admin\",\"password\":\"222222\"}")
                .when().post("/api/v1/users/login")
                    .then().log().ifValidationFails()
                    .statusCode(200)  // Login expects 200 - could be configurable in future
                    .extract().response();
                _jwt[0]     = loginRes.jsonPath().getString("data.token");
                _jwtType[0] = "Bearer";
                
                // âœ… SUCCESS: Clean login success reporting
                String tokenObtained = _jwt[0] != null ? "Yes" : "No";
                Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (Token: " + tokenObtained + ")");
                Allure.addAttachment("ğŸ” Login Response", "application/json", loginRes.getBody().asString());
            } catch (Throwable loginError) {
                loginSucceeded.set(false);
                
                // âŒ FAILURE: Clean login failure reporting
                String errorType = loginError.getClass().getSimpleName();
                if (loginError instanceof java.net.ConnectException) {
                    errorType = "Connection Failed";
                } else if (loginError instanceof AssertionError) {
                    errorType = "Authentication Failed";
                }
                
                Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                Allure.addAttachment("ğŸ’¥ Login Error", "text/plain", "Error: " + errorType + "\nMessage: " + loginError.getMessage());
                
                // Throw to mark login step as failed in Allure
                throw new RuntimeException("Login failed: " + loginError.getMessage(), loginError);
            }
        });
        String jwt     = _jwt[0];
        String jwtType = _jwtType[0];

        // Step execution results tracking
        final java.util.Map<Integer, Boolean> stepResults = new java.util.HashMap<>();
        final java.util.Map<Integer, String> capturedOutputs = new java.util.HashMap<>();

        // Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-admin-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/adminrouteservice/adminroute");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-admin-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/adminrouteservice/adminroute\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody1 = "{\"distanceList\":\"1.\",\"distances\":\"[\\\"43.5\\\", \\\"1207.9\\\", \\\"7891.2\\\", \\\"3456.3\\\", \\\"2198.4\\\"]\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"loginId\":\"4d2a46c7-71cb-4cf1-5bb-b68406d9da6f\",\"startStation\":\"hangzhou\",\"stationList\":\"waco\",\"stations\":\"[\\\"waco\\\"]\"}";
                        req = req.body(requestBody1);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody1);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse1 = req.when().post("/api/v1/adminrouteservice/adminroute")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(1, true);
                        System.out.println("âœ… Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse1.getBody().asString();
                            int actualStatus = stepResponse1.getStatusCode();
                            long responseTime = stepResponse1.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(1, false);
                        System.out.println("âŒ Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - " + skipReason);
                    stepResults.put(1, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 1 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 1 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200): " + stepException.getMessage());
                stepResults.put(1, false);
            }
        }

        // Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-station-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/stationservice/stations/idlist");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-station-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/stationservice/stations/idlist\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody2 = "[\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\"]";
                        req = req.body(requestBody2);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody2);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse2 = req.when().post("/api/v1/stationservice/stations/idlist")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(2, true);
                        System.out.println("âœ… Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse2.getBody().asString();
                            int actualStatus = stepResponse2.getStatusCode();
                            long responseTime = stepResponse2.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(2, false);
                        System.out.println("âŒ Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - " + skipReason);
                    stepResults.put(2, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 2 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 2 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200): " + stepException.getMessage());
                stepResults.put(2, false);
            }
        }

        // Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/routeservice/routes");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/routeservice/routes\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody3 = "{\"distanceList\":\"1.\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"startStation\":\"hangzhou\",\"stationList\":\"waco\"}";
                        req = req.body(requestBody3);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody3);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse3 = req.when().post("/api/v1/routeservice/routes")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(3, true);
                        System.out.println("âœ… Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse3.getBody().asString();
                            int actualStatus = stepResponse3.getStatusCode();
                            long responseTime = stepResponse3.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(3, false);
                        System.out.println("âŒ Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - " + skipReason);
                    stepResults.put(3, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 3 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 3 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200): " + stepException.getMessage());
                stepResults.put(3, false);
            }
        }

        // Evaluate scenario result with comprehensive reporting
        long successfulSteps = stepResults.values().stream().filter(result -> result).count();
        long failedSteps = stepResults.values().stream().filter(result -> !result).count();
        long totalSteps = stepResults.size();
        
        // Add clean test summary - no duplicate content
        String overallResult;
        String severity;
        if (!loginSucceeded.get()) {
            overallResult = "âŒ AUTHENTICATION FAILED";
            severity = "critical";
        } else if (failedSteps == 0) {
            overallResult = "âœ… ALL STEPS PASSED";
            severity = "normal";
        } else if (successfulSteps > 0) {
            overallResult = "âš ï¸ PARTIAL FAILURE";
            severity = "major";
        } else {
            overallResult = "âŒ ALL STEPS FAILED";
            severity = "critical";
        }
        
        // Single summary parameter with all key info
        Allure.parameter("ğŸ“Š Scenario Result", overallResult + " (" + successfulSteps + "/" + totalSteps + " steps)");
        
        // Add clean categorization
        Allure.label("severity", severity);
        Allure.label("feature", "Microservice Workflow");
        Allure.label("story", "test_POST_1_4");
        Allure.description("Microservice test scenario with " + totalSteps + " steps.");
        
        System.out.println("=== SCENARIO RESULT ===");
        System.out.println("Scenario: test_POST_1_4");
        System.out.println("Total Steps: " + totalSteps);
        System.out.println("Successful: " + successfulSteps);
        System.out.println("Failed: " + failedSteps);
        System.out.println("Login Status: " + (loginSucceeded.get() ? "SUCCESS" : "FAILED"));
        
        // IMPROVED: Test fails if ANY step fails or login fails (not just when ALL fail)
        if (!loginSucceeded.get()) {
            fail("Scenario FAILED: Authentication failed - cannot proceed with API calls");
        } else if (failedSteps > 0) {
            fail("Scenario FAILED: " + failedSteps + " out of " + totalSteps + " steps failed. " +
                 "In microservice testing, all workflow steps must succeed for end-to-end validation.");
        } else if (successfulSteps == 0) {
            fail("Scenario FAILED: No steps executed successfully - check service availability");
        } else {
            System.out.println("ğŸ‰ Scenario PASSED: All " + totalSteps + " steps completed successfully");
        }
    }

    @Test
    public void test_POST_1_5() throws Exception {
        final String[] _jwt     = new String[1];
        final String[] _jwtType = new String[1];
        final java.util.concurrent.atomic.AtomicBoolean loginSucceeded  = new java.util.concurrent.atomic.AtomicBoolean(true);
        final java.util.concurrent.atomic.AtomicBoolean scenarioFailed = new java.util.concurrent.atomic.AtomicBoolean(false);
        // ğŸ” STEP 0: Authentication - Clean reporting
        Allure.step("ğŸ” Step 0: Authentication (Login)", () -> {
            try {
                Allure.parameter("ğŸ¢ Service", "Authentication Service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/users/login");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ‘¤ Username", "admin");
                Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - Authentication required");
                Allure.description("ğŸ” **Authentication Step**\n" +
                                 "This step authenticates the user to obtain JWT token for subsequent API calls.\n" +
                                 "All other steps depend on successful authentication.");
                
                Response loginRes = RestAssured.given()
                    .contentType("application/json")
                    .body("{\"username\":\"admin\",\"password\":\"222222\"}")
                .when().post("/api/v1/users/login")
                    .then().log().ifValidationFails()
                    .statusCode(200)  // Login expects 200 - could be configurable in future
                    .extract().response();
                _jwt[0]     = loginRes.jsonPath().getString("data.token");
                _jwtType[0] = "Bearer";
                
                // âœ… SUCCESS: Clean login success reporting
                String tokenObtained = _jwt[0] != null ? "Yes" : "No";
                Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (Token: " + tokenObtained + ")");
                Allure.addAttachment("ğŸ” Login Response", "application/json", loginRes.getBody().asString());
            } catch (Throwable loginError) {
                loginSucceeded.set(false);
                
                // âŒ FAILURE: Clean login failure reporting
                String errorType = loginError.getClass().getSimpleName();
                if (loginError instanceof java.net.ConnectException) {
                    errorType = "Connection Failed";
                } else if (loginError instanceof AssertionError) {
                    errorType = "Authentication Failed";
                }
                
                Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                Allure.addAttachment("ğŸ’¥ Login Error", "text/plain", "Error: " + errorType + "\nMessage: " + loginError.getMessage());
                
                // Throw to mark login step as failed in Allure
                throw new RuntimeException("Login failed: " + loginError.getMessage(), loginError);
            }
        });
        String jwt     = _jwt[0];
        String jwtType = _jwtType[0];

        // Step execution results tracking
        final java.util.Map<Integer, Boolean> stepResults = new java.util.HashMap<>();
        final java.util.Map<Integer, String> capturedOutputs = new java.util.HashMap<>();

        // Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-admin-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/adminrouteservice/adminroute");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-admin-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/adminrouteservice/adminroute\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody1 = "{\"distanceList\":\"1.\",\"distances\":\"[\\\"43.5\\\", \\\"1207.9\\\", \\\"7891.2\\\", \\\"3456.3\\\", \\\"2198.4\\\"]\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"loginId\":\"4d2a46c7-71cb-4cf1-a8b6-b68406da5a9f\",\"startStation\":\"shanghai\",\"stationList\":\"shijiazhuang\",\"stations\":\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Ferry Building\\\", \\\"Washington Union Station\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\"]\"}";
                        req = req.body(requestBody1);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody1);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse1 = req.when().post("/api/v1/adminrouteservice/adminroute")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(1, true);
                        System.out.println("âœ… Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse1.getBody().asString();
                            int actualStatus = stepResponse1.getStatusCode();
                            long responseTime = stepResponse1.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(1, false);
                        System.out.println("âŒ Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - " + skipReason);
                    stepResults.put(1, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 1 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 1 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200): " + stepException.getMessage());
                stepResults.put(1, false);
            }
        }

        // Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-station-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/stationservice/stations/idlist");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-station-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/stationservice/stations/idlist\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody2 = "[\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\"]";
                        req = req.body(requestBody2);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody2);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse2 = req.when().post("/api/v1/stationservice/stations/idlist")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(2, true);
                        System.out.println("âœ… Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse2.getBody().asString();
                            int actualStatus = stepResponse2.getStatusCode();
                            long responseTime = stepResponse2.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(2, false);
                        System.out.println("âŒ Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - " + skipReason);
                    stepResults.put(2, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 2 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 2 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200): " + stepException.getMessage());
                stepResults.put(2, false);
            }
        }

        // Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/routeservice/routes");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/routeservice/routes\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody3 = "{\"distanceList\":\"1.\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"startStation\":\"shanghai\",\"stationList\":\"shijiazhuang\"}";
                        req = req.body(requestBody3);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody3);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse3 = req.when().post("/api/v1/routeservice/routes")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(3, true);
                        System.out.println("âœ… Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse3.getBody().asString();
                            int actualStatus = stepResponse3.getStatusCode();
                            long responseTime = stepResponse3.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(3, false);
                        System.out.println("âŒ Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - " + skipReason);
                    stepResults.put(3, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 3 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 3 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200): " + stepException.getMessage());
                stepResults.put(3, false);
            }
        }

        // Evaluate scenario result with comprehensive reporting
        long successfulSteps = stepResults.values().stream().filter(result -> result).count();
        long failedSteps = stepResults.values().stream().filter(result -> !result).count();
        long totalSteps = stepResults.size();
        
        // Add clean test summary - no duplicate content
        String overallResult;
        String severity;
        if (!loginSucceeded.get()) {
            overallResult = "âŒ AUTHENTICATION FAILED";
            severity = "critical";
        } else if (failedSteps == 0) {
            overallResult = "âœ… ALL STEPS PASSED";
            severity = "normal";
        } else if (successfulSteps > 0) {
            overallResult = "âš ï¸ PARTIAL FAILURE";
            severity = "major";
        } else {
            overallResult = "âŒ ALL STEPS FAILED";
            severity = "critical";
        }
        
        // Single summary parameter with all key info
        Allure.parameter("ğŸ“Š Scenario Result", overallResult + " (" + successfulSteps + "/" + totalSteps + " steps)");
        
        // Add clean categorization
        Allure.label("severity", severity);
        Allure.label("feature", "Microservice Workflow");
        Allure.label("story", "test_POST_1_5");
        Allure.description("Microservice test scenario with " + totalSteps + " steps.");
        
        System.out.println("=== SCENARIO RESULT ===");
        System.out.println("Scenario: test_POST_1_5");
        System.out.println("Total Steps: " + totalSteps);
        System.out.println("Successful: " + successfulSteps);
        System.out.println("Failed: " + failedSteps);
        System.out.println("Login Status: " + (loginSucceeded.get() ? "SUCCESS" : "FAILED"));
        
        // IMPROVED: Test fails if ANY step fails or login fails (not just when ALL fail)
        if (!loginSucceeded.get()) {
            fail("Scenario FAILED: Authentication failed - cannot proceed with API calls");
        } else if (failedSteps > 0) {
            fail("Scenario FAILED: " + failedSteps + " out of " + totalSteps + " steps failed. " +
                 "In microservice testing, all workflow steps must succeed for end-to-end validation.");
        } else if (successfulSteps == 0) {
            fail("Scenario FAILED: No steps executed successfully - check service availability");
        } else {
            System.out.println("ğŸ‰ Scenario PASSED: All " + totalSteps + " steps completed successfully");
        }
    }

    @Test
    public void test_POST_1_6() throws Exception {
        final String[] _jwt     = new String[1];
        final String[] _jwtType = new String[1];
        final java.util.concurrent.atomic.AtomicBoolean loginSucceeded  = new java.util.concurrent.atomic.AtomicBoolean(true);
        final java.util.concurrent.atomic.AtomicBoolean scenarioFailed = new java.util.concurrent.atomic.AtomicBoolean(false);
        // ğŸ” STEP 0: Authentication - Clean reporting
        Allure.step("ğŸ” Step 0: Authentication (Login)", () -> {
            try {
                Allure.parameter("ğŸ¢ Service", "Authentication Service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/users/login");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ‘¤ Username", "admin");
                Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - Authentication required");
                Allure.description("ğŸ” **Authentication Step**\n" +
                                 "This step authenticates the user to obtain JWT token for subsequent API calls.\n" +
                                 "All other steps depend on successful authentication.");
                
                Response loginRes = RestAssured.given()
                    .contentType("application/json")
                    .body("{\"username\":\"admin\",\"password\":\"222222\"}")
                .when().post("/api/v1/users/login")
                    .then().log().ifValidationFails()
                    .statusCode(200)  // Login expects 200 - could be configurable in future
                    .extract().response();
                _jwt[0]     = loginRes.jsonPath().getString("data.token");
                _jwtType[0] = "Bearer";
                
                // âœ… SUCCESS: Clean login success reporting
                String tokenObtained = _jwt[0] != null ? "Yes" : "No";
                Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (Token: " + tokenObtained + ")");
                Allure.addAttachment("ğŸ” Login Response", "application/json", loginRes.getBody().asString());
            } catch (Throwable loginError) {
                loginSucceeded.set(false);
                
                // âŒ FAILURE: Clean login failure reporting
                String errorType = loginError.getClass().getSimpleName();
                if (loginError instanceof java.net.ConnectException) {
                    errorType = "Connection Failed";
                } else if (loginError instanceof AssertionError) {
                    errorType = "Authentication Failed";
                }
                
                Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                Allure.addAttachment("ğŸ’¥ Login Error", "text/plain", "Error: " + errorType + "\nMessage: " + loginError.getMessage());
                
                // Throw to mark login step as failed in Allure
                throw new RuntimeException("Login failed: " + loginError.getMessage(), loginError);
            }
        });
        String jwt     = _jwt[0];
        String jwtType = _jwtType[0];

        // Step execution results tracking
        final java.util.Map<Integer, Boolean> stepResults = new java.util.HashMap<>();
        final java.util.Map<Integer, String> capturedOutputs = new java.util.HashMap<>();

        // Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-admin-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/adminrouteservice/adminroute");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-admin-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/adminrouteservice/adminroute\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody1 = "{\"distanceList\":\"1.\",\"distances\":\"[\\\"43.5\\\", \\\"1207.9\\\", \\\"7891.2\\\", \\\"3456.3\\\", \\\"2198.4\\\"]\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"loginId\":\"3e8a52ec-f0eb-41a4-c4bb-d98db345678a\",\"startStation\":\"jinan\",\"stationList\":\"austin\",\"stations\":\"[\\\"shijiazhuang\\\"]\"}";
                        req = req.body(requestBody1);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody1);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse1 = req.when().post("/api/v1/adminrouteservice/adminroute")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(1, true);
                        System.out.println("âœ… Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse1.getBody().asString();
                            int actualStatus = stepResponse1.getStatusCode();
                            long responseTime = stepResponse1.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(1, false);
                        System.out.println("âŒ Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - " + skipReason);
                    stepResults.put(1, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 1 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 1 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200): " + stepException.getMessage());
                stepResults.put(1, false);
            }
        }

        // Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-station-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/stationservice/stations/idlist");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-station-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/stationservice/stations/idlist\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody2 = "[\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\"]";
                        req = req.body(requestBody2);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody2);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse2 = req.when().post("/api/v1/stationservice/stations/idlist")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(2, true);
                        System.out.println("âœ… Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse2.getBody().asString();
                            int actualStatus = stepResponse2.getStatusCode();
                            long responseTime = stepResponse2.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(2, false);
                        System.out.println("âŒ Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - " + skipReason);
                    stepResults.put(2, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 2 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 2 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200): " + stepException.getMessage());
                stepResults.put(2, false);
            }
        }

        // Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/routeservice/routes");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/routeservice/routes\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody3 = "{\"distanceList\":\"1.\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"startStation\":\"jinan\",\"stationList\":\"austin\"}";
                        req = req.body(requestBody3);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody3);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse3 = req.when().post("/api/v1/routeservice/routes")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(3, true);
                        System.out.println("âœ… Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse3.getBody().asString();
                            int actualStatus = stepResponse3.getStatusCode();
                            long responseTime = stepResponse3.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(3, false);
                        System.out.println("âŒ Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - " + skipReason);
                    stepResults.put(3, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 3 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 3 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200): " + stepException.getMessage());
                stepResults.put(3, false);
            }
        }

        // Evaluate scenario result with comprehensive reporting
        long successfulSteps = stepResults.values().stream().filter(result -> result).count();
        long failedSteps = stepResults.values().stream().filter(result -> !result).count();
        long totalSteps = stepResults.size();
        
        // Add clean test summary - no duplicate content
        String overallResult;
        String severity;
        if (!loginSucceeded.get()) {
            overallResult = "âŒ AUTHENTICATION FAILED";
            severity = "critical";
        } else if (failedSteps == 0) {
            overallResult = "âœ… ALL STEPS PASSED";
            severity = "normal";
        } else if (successfulSteps > 0) {
            overallResult = "âš ï¸ PARTIAL FAILURE";
            severity = "major";
        } else {
            overallResult = "âŒ ALL STEPS FAILED";
            severity = "critical";
        }
        
        // Single summary parameter with all key info
        Allure.parameter("ğŸ“Š Scenario Result", overallResult + " (" + successfulSteps + "/" + totalSteps + " steps)");
        
        // Add clean categorization
        Allure.label("severity", severity);
        Allure.label("feature", "Microservice Workflow");
        Allure.label("story", "test_POST_1_6");
        Allure.description("Microservice test scenario with " + totalSteps + " steps.");
        
        System.out.println("=== SCENARIO RESULT ===");
        System.out.println("Scenario: test_POST_1_6");
        System.out.println("Total Steps: " + totalSteps);
        System.out.println("Successful: " + successfulSteps);
        System.out.println("Failed: " + failedSteps);
        System.out.println("Login Status: " + (loginSucceeded.get() ? "SUCCESS" : "FAILED"));
        
        // IMPROVED: Test fails if ANY step fails or login fails (not just when ALL fail)
        if (!loginSucceeded.get()) {
            fail("Scenario FAILED: Authentication failed - cannot proceed with API calls");
        } else if (failedSteps > 0) {
            fail("Scenario FAILED: " + failedSteps + " out of " + totalSteps + " steps failed. " +
                 "In microservice testing, all workflow steps must succeed for end-to-end validation.");
        } else if (successfulSteps == 0) {
            fail("Scenario FAILED: No steps executed successfully - check service availability");
        } else {
            System.out.println("ğŸ‰ Scenario PASSED: All " + totalSteps + " steps completed successfully");
        }
    }

    @Test
    public void test_POST_1_7() throws Exception {
        final String[] _jwt     = new String[1];
        final String[] _jwtType = new String[1];
        final java.util.concurrent.atomic.AtomicBoolean loginSucceeded  = new java.util.concurrent.atomic.AtomicBoolean(true);
        final java.util.concurrent.atomic.AtomicBoolean scenarioFailed = new java.util.concurrent.atomic.AtomicBoolean(false);
        // ğŸ” STEP 0: Authentication - Clean reporting
        Allure.step("ğŸ” Step 0: Authentication (Login)", () -> {
            try {
                Allure.parameter("ğŸ¢ Service", "Authentication Service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/users/login");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ‘¤ Username", "admin");
                Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - Authentication required");
                Allure.description("ğŸ” **Authentication Step**\n" +
                                 "This step authenticates the user to obtain JWT token for subsequent API calls.\n" +
                                 "All other steps depend on successful authentication.");
                
                Response loginRes = RestAssured.given()
                    .contentType("application/json")
                    .body("{\"username\":\"admin\",\"password\":\"222222\"}")
                .when().post("/api/v1/users/login")
                    .then().log().ifValidationFails()
                    .statusCode(200)  // Login expects 200 - could be configurable in future
                    .extract().response();
                _jwt[0]     = loginRes.jsonPath().getString("data.token");
                _jwtType[0] = "Bearer";
                
                // âœ… SUCCESS: Clean login success reporting
                String tokenObtained = _jwt[0] != null ? "Yes" : "No";
                Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (Token: " + tokenObtained + ")");
                Allure.addAttachment("ğŸ” Login Response", "application/json", loginRes.getBody().asString());
            } catch (Throwable loginError) {
                loginSucceeded.set(false);
                
                // âŒ FAILURE: Clean login failure reporting
                String errorType = loginError.getClass().getSimpleName();
                if (loginError instanceof java.net.ConnectException) {
                    errorType = "Connection Failed";
                } else if (loginError instanceof AssertionError) {
                    errorType = "Authentication Failed";
                }
                
                Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                Allure.addAttachment("ğŸ’¥ Login Error", "text/plain", "Error: " + errorType + "\nMessage: " + loginError.getMessage());
                
                // Throw to mark login step as failed in Allure
                throw new RuntimeException("Login failed: " + loginError.getMessage(), loginError);
            }
        });
        String jwt     = _jwt[0];
        String jwtType = _jwtType[0];

        // Step execution results tracking
        final java.util.Map<Integer, Boolean> stepResults = new java.util.HashMap<>();
        final java.util.Map<Integer, String> capturedOutputs = new java.util.HashMap<>();

        // Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-admin-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/adminrouteservice/adminroute");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-admin-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/adminrouteservice/adminroute\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody1 = "{\"distanceList\":\"1.\",\"distances\":\"[\\\"43.5\\\", \\\"1207.9\\\", \\\"7891.2\\\", \\\"3456.3\\\", \\\"2198.4\\\"]\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"loginId\":\"fdse_microservice_123abc\",\"startStation\":\"jiaxingnan\",\"stationList\":\"wuxi\",\"stations\":\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Ferry Building\\\", \\\"Washington Union Station\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\"]\"}";
                        req = req.body(requestBody1);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody1);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse1 = req.when().post("/api/v1/adminrouteservice/adminroute")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(1, true);
                        System.out.println("âœ… Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse1.getBody().asString();
                            int actualStatus = stepResponse1.getStatusCode();
                            long responseTime = stepResponse1.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(1, false);
                        System.out.println("âŒ Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - " + skipReason);
                    stepResults.put(1, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 1 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 1 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200): " + stepException.getMessage());
                stepResults.put(1, false);
            }
        }

        // Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-station-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/stationservice/stations/idlist");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-station-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/stationservice/stations/idlist\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody2 = "[\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\"]";
                        req = req.body(requestBody2);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody2);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse2 = req.when().post("/api/v1/stationservice/stations/idlist")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(2, true);
                        System.out.println("âœ… Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse2.getBody().asString();
                            int actualStatus = stepResponse2.getStatusCode();
                            long responseTime = stepResponse2.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(2, false);
                        System.out.println("âŒ Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - " + skipReason);
                    stepResults.put(2, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 2 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 2 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200): " + stepException.getMessage());
                stepResults.put(2, false);
            }
        }

        // Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/routeservice/routes");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/routeservice/routes\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody3 = "{\"distanceList\":\"1.\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"startStation\":\"jiaxingnan\",\"stationList\":\"wuxi\"}";
                        req = req.body(requestBody3);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody3);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse3 = req.when().post("/api/v1/routeservice/routes")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(3, true);
                        System.out.println("âœ… Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse3.getBody().asString();
                            int actualStatus = stepResponse3.getStatusCode();
                            long responseTime = stepResponse3.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(3, false);
                        System.out.println("âŒ Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - " + skipReason);
                    stepResults.put(3, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 3 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 3 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200): " + stepException.getMessage());
                stepResults.put(3, false);
            }
        }

        // Evaluate scenario result with comprehensive reporting
        long successfulSteps = stepResults.values().stream().filter(result -> result).count();
        long failedSteps = stepResults.values().stream().filter(result -> !result).count();
        long totalSteps = stepResults.size();
        
        // Add clean test summary - no duplicate content
        String overallResult;
        String severity;
        if (!loginSucceeded.get()) {
            overallResult = "âŒ AUTHENTICATION FAILED";
            severity = "critical";
        } else if (failedSteps == 0) {
            overallResult = "âœ… ALL STEPS PASSED";
            severity = "normal";
        } else if (successfulSteps > 0) {
            overallResult = "âš ï¸ PARTIAL FAILURE";
            severity = "major";
        } else {
            overallResult = "âŒ ALL STEPS FAILED";
            severity = "critical";
        }
        
        // Single summary parameter with all key info
        Allure.parameter("ğŸ“Š Scenario Result", overallResult + " (" + successfulSteps + "/" + totalSteps + " steps)");
        
        // Add clean categorization
        Allure.label("severity", severity);
        Allure.label("feature", "Microservice Workflow");
        Allure.label("story", "test_POST_1_7");
        Allure.description("Microservice test scenario with " + totalSteps + " steps.");
        
        System.out.println("=== SCENARIO RESULT ===");
        System.out.println("Scenario: test_POST_1_7");
        System.out.println("Total Steps: " + totalSteps);
        System.out.println("Successful: " + successfulSteps);
        System.out.println("Failed: " + failedSteps);
        System.out.println("Login Status: " + (loginSucceeded.get() ? "SUCCESS" : "FAILED"));
        
        // IMPROVED: Test fails if ANY step fails or login fails (not just when ALL fail)
        if (!loginSucceeded.get()) {
            fail("Scenario FAILED: Authentication failed - cannot proceed with API calls");
        } else if (failedSteps > 0) {
            fail("Scenario FAILED: " + failedSteps + " out of " + totalSteps + " steps failed. " +
                 "In microservice testing, all workflow steps must succeed for end-to-end validation.");
        } else if (successfulSteps == 0) {
            fail("Scenario FAILED: No steps executed successfully - check service availability");
        } else {
            System.out.println("ğŸ‰ Scenario PASSED: All " + totalSteps + " steps completed successfully");
        }
    }

    @Test
    public void test_POST_1_8() throws Exception {
        final String[] _jwt     = new String[1];
        final String[] _jwtType = new String[1];
        final java.util.concurrent.atomic.AtomicBoolean loginSucceeded  = new java.util.concurrent.atomic.AtomicBoolean(true);
        final java.util.concurrent.atomic.AtomicBoolean scenarioFailed = new java.util.concurrent.atomic.AtomicBoolean(false);
        // ğŸ” STEP 0: Authentication - Clean reporting
        Allure.step("ğŸ” Step 0: Authentication (Login)", () -> {
            try {
                Allure.parameter("ğŸ¢ Service", "Authentication Service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/users/login");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ‘¤ Username", "admin");
                Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - Authentication required");
                Allure.description("ğŸ” **Authentication Step**\n" +
                                 "This step authenticates the user to obtain JWT token for subsequent API calls.\n" +
                                 "All other steps depend on successful authentication.");
                
                Response loginRes = RestAssured.given()
                    .contentType("application/json")
                    .body("{\"username\":\"admin\",\"password\":\"222222\"}")
                .when().post("/api/v1/users/login")
                    .then().log().ifValidationFails()
                    .statusCode(200)  // Login expects 200 - could be configurable in future
                    .extract().response();
                _jwt[0]     = loginRes.jsonPath().getString("data.token");
                _jwtType[0] = "Bearer";
                
                // âœ… SUCCESS: Clean login success reporting
                String tokenObtained = _jwt[0] != null ? "Yes" : "No";
                Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (Token: " + tokenObtained + ")");
                Allure.addAttachment("ğŸ” Login Response", "application/json", loginRes.getBody().asString());
            } catch (Throwable loginError) {
                loginSucceeded.set(false);
                
                // âŒ FAILURE: Clean login failure reporting
                String errorType = loginError.getClass().getSimpleName();
                if (loginError instanceof java.net.ConnectException) {
                    errorType = "Connection Failed";
                } else if (loginError instanceof AssertionError) {
                    errorType = "Authentication Failed";
                }
                
                Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                Allure.addAttachment("ğŸ’¥ Login Error", "text/plain", "Error: " + errorType + "\nMessage: " + loginError.getMessage());
                
                // Throw to mark login step as failed in Allure
                throw new RuntimeException("Login failed: " + loginError.getMessage(), loginError);
            }
        });
        String jwt     = _jwt[0];
        String jwtType = _jwtType[0];

        // Step execution results tracking
        final java.util.Map<Integer, Boolean> stepResults = new java.util.HashMap<>();
        final java.util.Map<Integer, String> capturedOutputs = new java.util.HashMap<>();

        // Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-admin-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/adminrouteservice/adminroute");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-admin-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/adminrouteservice/adminroute\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody1 = "{\"distanceList\":\"1.\",\"distances\":\"[\\\"43.5\\\", \\\"1207.9\\\", \\\"7891.2\\\", \\\"3456.3\\\", \\\"2198.4\\\"]\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"loginId\":\"4d2a46c7-71cb-4cf1-5\",\"startStation\":\"zhenjiang\",\"stationList\":\"shanghaihongqiao\",\"stations\":\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Ferry Building\\\", \\\"Washington Union Station\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\"]\"}";
                        req = req.body(requestBody1);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody1);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse1 = req.when().post("/api/v1/adminrouteservice/adminroute")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(1, true);
                        System.out.println("âœ… Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse1.getBody().asString();
                            int actualStatus = stepResponse1.getStatusCode();
                            long responseTime = stepResponse1.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(1, false);
                        System.out.println("âŒ Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - " + skipReason);
                    stepResults.put(1, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 1 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 1 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200): " + stepException.getMessage());
                stepResults.put(1, false);
            }
        }

        // Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-station-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/stationservice/stations/idlist");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-station-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/stationservice/stations/idlist\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody2 = "[\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\"]";
                        req = req.body(requestBody2);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody2);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse2 = req.when().post("/api/v1/stationservice/stations/idlist")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(2, true);
                        System.out.println("âœ… Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse2.getBody().asString();
                            int actualStatus = stepResponse2.getStatusCode();
                            long responseTime = stepResponse2.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(2, false);
                        System.out.println("âŒ Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - " + skipReason);
                    stepResults.put(2, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 2 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 2 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200): " + stepException.getMessage());
                stepResults.put(2, false);
            }
        }

        // Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/routeservice/routes");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/routeservice/routes\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody3 = "{\"distanceList\":\"1.\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"startStation\":\"zhenjiang\",\"stationList\":\"shanghaihongqiao\"}";
                        req = req.body(requestBody3);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody3);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse3 = req.when().post("/api/v1/routeservice/routes")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(3, true);
                        System.out.println("âœ… Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse3.getBody().asString();
                            int actualStatus = stepResponse3.getStatusCode();
                            long responseTime = stepResponse3.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(3, false);
                        System.out.println("âŒ Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - " + skipReason);
                    stepResults.put(3, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 3 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 3 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200): " + stepException.getMessage());
                stepResults.put(3, false);
            }
        }

        // Evaluate scenario result with comprehensive reporting
        long successfulSteps = stepResults.values().stream().filter(result -> result).count();
        long failedSteps = stepResults.values().stream().filter(result -> !result).count();
        long totalSteps = stepResults.size();
        
        // Add clean test summary - no duplicate content
        String overallResult;
        String severity;
        if (!loginSucceeded.get()) {
            overallResult = "âŒ AUTHENTICATION FAILED";
            severity = "critical";
        } else if (failedSteps == 0) {
            overallResult = "âœ… ALL STEPS PASSED";
            severity = "normal";
        } else if (successfulSteps > 0) {
            overallResult = "âš ï¸ PARTIAL FAILURE";
            severity = "major";
        } else {
            overallResult = "âŒ ALL STEPS FAILED";
            severity = "critical";
        }
        
        // Single summary parameter with all key info
        Allure.parameter("ğŸ“Š Scenario Result", overallResult + " (" + successfulSteps + "/" + totalSteps + " steps)");
        
        // Add clean categorization
        Allure.label("severity", severity);
        Allure.label("feature", "Microservice Workflow");
        Allure.label("story", "test_POST_1_8");
        Allure.description("Microservice test scenario with " + totalSteps + " steps.");
        
        System.out.println("=== SCENARIO RESULT ===");
        System.out.println("Scenario: test_POST_1_8");
        System.out.println("Total Steps: " + totalSteps);
        System.out.println("Successful: " + successfulSteps);
        System.out.println("Failed: " + failedSteps);
        System.out.println("Login Status: " + (loginSucceeded.get() ? "SUCCESS" : "FAILED"));
        
        // IMPROVED: Test fails if ANY step fails or login fails (not just when ALL fail)
        if (!loginSucceeded.get()) {
            fail("Scenario FAILED: Authentication failed - cannot proceed with API calls");
        } else if (failedSteps > 0) {
            fail("Scenario FAILED: " + failedSteps + " out of " + totalSteps + " steps failed. " +
                 "In microservice testing, all workflow steps must succeed for end-to-end validation.");
        } else if (successfulSteps == 0) {
            fail("Scenario FAILED: No steps executed successfully - check service availability");
        } else {
            System.out.println("ğŸ‰ Scenario PASSED: All " + totalSteps + " steps completed successfully");
        }
    }

    @Test
    public void test_POST_1_9() throws Exception {
        final String[] _jwt     = new String[1];
        final String[] _jwtType = new String[1];
        final java.util.concurrent.atomic.AtomicBoolean loginSucceeded  = new java.util.concurrent.atomic.AtomicBoolean(true);
        final java.util.concurrent.atomic.AtomicBoolean scenarioFailed = new java.util.concurrent.atomic.AtomicBoolean(false);
        // ğŸ” STEP 0: Authentication - Clean reporting
        Allure.step("ğŸ” Step 0: Authentication (Login)", () -> {
            try {
                Allure.parameter("ğŸ¢ Service", "Authentication Service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/users/login");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ‘¤ Username", "admin");
                Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - Authentication required");
                Allure.description("ğŸ” **Authentication Step**\n" +
                                 "This step authenticates the user to obtain JWT token for subsequent API calls.\n" +
                                 "All other steps depend on successful authentication.");
                
                Response loginRes = RestAssured.given()
                    .contentType("application/json")
                    .body("{\"username\":\"admin\",\"password\":\"222222\"}")
                .when().post("/api/v1/users/login")
                    .then().log().ifValidationFails()
                    .statusCode(200)  // Login expects 200 - could be configurable in future
                    .extract().response();
                _jwt[0]     = loginRes.jsonPath().getString("data.token");
                _jwtType[0] = "Bearer";
                
                // âœ… SUCCESS: Clean login success reporting
                String tokenObtained = _jwt[0] != null ? "Yes" : "No";
                Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (Token: " + tokenObtained + ")");
                Allure.addAttachment("ğŸ” Login Response", "application/json", loginRes.getBody().asString());
            } catch (Throwable loginError) {
                loginSucceeded.set(false);
                
                // âŒ FAILURE: Clean login failure reporting
                String errorType = loginError.getClass().getSimpleName();
                if (loginError instanceof java.net.ConnectException) {
                    errorType = "Connection Failed";
                } else if (loginError instanceof AssertionError) {
                    errorType = "Authentication Failed";
                }
                
                Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                Allure.addAttachment("ğŸ’¥ Login Error", "text/plain", "Error: " + errorType + "\nMessage: " + loginError.getMessage());
                
                // Throw to mark login step as failed in Allure
                throw new RuntimeException("Login failed: " + loginError.getMessage(), loginError);
            }
        });
        String jwt     = _jwt[0];
        String jwtType = _jwtType[0];

        // Step execution results tracking
        final java.util.Map<Integer, Boolean> stepResults = new java.util.HashMap<>();
        final java.util.Map<Integer, String> capturedOutputs = new java.util.HashMap<>();

        // Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-admin-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/adminrouteservice/adminroute");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-admin-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/adminrouteservice/adminroute\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody1 = "{\"distanceList\":\"1.\",\"distances\":\"[\\\"43.5\\\", \\\"1207.9\\\", \\\"7891.2\\\", \\\"3456.3\\\", \\\"2198.4\\\"]\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"loginId\":\"fdse_microservice\",\"startStation\":\"xuzhou\",\"stationList\":\"zhenjiang\",\"stations\":\"[\\\"austin\\\"]\"}";
                        req = req.body(requestBody1);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody1);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse1 = req.when().post("/api/v1/adminrouteservice/adminroute")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(1, true);
                        System.out.println("âœ… Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse1.getBody().asString();
                            int actualStatus = stepResponse1.getStatusCode();
                            long responseTime = stepResponse1.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(1, false);
                        System.out.println("âŒ Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - " + skipReason);
                    stepResults.put(1, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 1 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 1 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200): " + stepException.getMessage());
                stepResults.put(1, false);
            }
        }

        // Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-station-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/stationservice/stations/idlist");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-station-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/stationservice/stations/idlist\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody2 = "[\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\"]";
                        req = req.body(requestBody2);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody2);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse2 = req.when().post("/api/v1/stationservice/stations/idlist")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(2, true);
                        System.out.println("âœ… Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse2.getBody().asString();
                            int actualStatus = stepResponse2.getStatusCode();
                            long responseTime = stepResponse2.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(2, false);
                        System.out.println("âŒ Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - " + skipReason);
                    stepResults.put(2, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 2 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 2 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200): " + stepException.getMessage());
                stepResults.put(2, false);
            }
        }

        // Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/routeservice/routes");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/routeservice/routes\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody3 = "{\"distanceList\":\"1.\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"startStation\":\"xuzhou\",\"stationList\":\"zhenjiang\"}";
                        req = req.body(requestBody3);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody3);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse3 = req.when().post("/api/v1/routeservice/routes")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(3, true);
                        System.out.println("âœ… Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse3.getBody().asString();
                            int actualStatus = stepResponse3.getStatusCode();
                            long responseTime = stepResponse3.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(3, false);
                        System.out.println("âŒ Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - " + skipReason);
                    stepResults.put(3, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 3 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 3 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200): " + stepException.getMessage());
                stepResults.put(3, false);
            }
        }

        // Evaluate scenario result with comprehensive reporting
        long successfulSteps = stepResults.values().stream().filter(result -> result).count();
        long failedSteps = stepResults.values().stream().filter(result -> !result).count();
        long totalSteps = stepResults.size();
        
        // Add clean test summary - no duplicate content
        String overallResult;
        String severity;
        if (!loginSucceeded.get()) {
            overallResult = "âŒ AUTHENTICATION FAILED";
            severity = "critical";
        } else if (failedSteps == 0) {
            overallResult = "âœ… ALL STEPS PASSED";
            severity = "normal";
        } else if (successfulSteps > 0) {
            overallResult = "âš ï¸ PARTIAL FAILURE";
            severity = "major";
        } else {
            overallResult = "âŒ ALL STEPS FAILED";
            severity = "critical";
        }
        
        // Single summary parameter with all key info
        Allure.parameter("ğŸ“Š Scenario Result", overallResult + " (" + successfulSteps + "/" + totalSteps + " steps)");
        
        // Add clean categorization
        Allure.label("severity", severity);
        Allure.label("feature", "Microservice Workflow");
        Allure.label("story", "test_POST_1_9");
        Allure.description("Microservice test scenario with " + totalSteps + " steps.");
        
        System.out.println("=== SCENARIO RESULT ===");
        System.out.println("Scenario: test_POST_1_9");
        System.out.println("Total Steps: " + totalSteps);
        System.out.println("Successful: " + successfulSteps);
        System.out.println("Failed: " + failedSteps);
        System.out.println("Login Status: " + (loginSucceeded.get() ? "SUCCESS" : "FAILED"));
        
        // IMPROVED: Test fails if ANY step fails or login fails (not just when ALL fail)
        if (!loginSucceeded.get()) {
            fail("Scenario FAILED: Authentication failed - cannot proceed with API calls");
        } else if (failedSteps > 0) {
            fail("Scenario FAILED: " + failedSteps + " out of " + totalSteps + " steps failed. " +
                 "In microservice testing, all workflow steps must succeed for end-to-end validation.");
        } else if (successfulSteps == 0) {
            fail("Scenario FAILED: No steps executed successfully - check service availability");
        } else {
            System.out.println("ğŸ‰ Scenario PASSED: All " + totalSteps + " steps completed successfully");
        }
    }

    @Test
    public void test_POST_1_10() throws Exception {
        final String[] _jwt     = new String[1];
        final String[] _jwtType = new String[1];
        final java.util.concurrent.atomic.AtomicBoolean loginSucceeded  = new java.util.concurrent.atomic.AtomicBoolean(true);
        final java.util.concurrent.atomic.AtomicBoolean scenarioFailed = new java.util.concurrent.atomic.AtomicBoolean(false);
        // ğŸ” STEP 0: Authentication - Clean reporting
        Allure.step("ğŸ” Step 0: Authentication (Login)", () -> {
            try {
                Allure.parameter("ğŸ¢ Service", "Authentication Service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/users/login");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ‘¤ Username", "admin");
                Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - Authentication required");
                Allure.description("ğŸ” **Authentication Step**\n" +
                                 "This step authenticates the user to obtain JWT token for subsequent API calls.\n" +
                                 "All other steps depend on successful authentication.");
                
                Response loginRes = RestAssured.given()
                    .contentType("application/json")
                    .body("{\"username\":\"admin\",\"password\":\"222222\"}")
                .when().post("/api/v1/users/login")
                    .then().log().ifValidationFails()
                    .statusCode(200)  // Login expects 200 - could be configurable in future
                    .extract().response();
                _jwt[0]     = loginRes.jsonPath().getString("data.token");
                _jwtType[0] = "Bearer";
                
                // âœ… SUCCESS: Clean login success reporting
                String tokenObtained = _jwt[0] != null ? "Yes" : "No";
                Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (Token: " + tokenObtained + ")");
                Allure.addAttachment("ğŸ” Login Response", "application/json", loginRes.getBody().asString());
            } catch (Throwable loginError) {
                loginSucceeded.set(false);
                
                // âŒ FAILURE: Clean login failure reporting
                String errorType = loginError.getClass().getSimpleName();
                if (loginError instanceof java.net.ConnectException) {
                    errorType = "Connection Failed";
                } else if (loginError instanceof AssertionError) {
                    errorType = "Authentication Failed";
                }
                
                Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                Allure.addAttachment("ğŸ’¥ Login Error", "text/plain", "Error: " + errorType + "\nMessage: " + loginError.getMessage());
                
                // Throw to mark login step as failed in Allure
                throw new RuntimeException("Login failed: " + loginError.getMessage(), loginError);
            }
        });
        String jwt     = _jwt[0];
        String jwtType = _jwtType[0];

        // Step execution results tracking
        final java.util.Map<Integer, Boolean> stepResults = new java.util.HashMap<>();
        final java.util.Map<Integer, String> capturedOutputs = new java.util.HashMap<>();

        // Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-admin-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/adminrouteservice/adminroute");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-admin-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/adminrouteservice/adminroute\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody1 = "{\"distanceList\":\"1.\",\"distances\":\"[\\\"43.5\\\", \\\"1207.9\\\", \\\"7891.2\\\", \\\"3456.3\\\", \\\"2198.4\\\"]\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"loginId\":\"4d2a46c7-71cb-4cf1-5bb-b68406d9da6f\",\"startStation\":\"wuxi\",\"stationList\":\"jiaxingnan\",\"stations\":\"[\\\"hangzhou\\\"]\"}";
                        req = req.body(requestBody1);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody1);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse1 = req.when().post("/api/v1/adminrouteservice/adminroute")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(1, true);
                        System.out.println("âœ… Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse1.getBody().asString();
                            int actualStatus = stepResponse1.getStatusCode();
                            long responseTime = stepResponse1.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(1, false);
                        System.out.println("âŒ Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200) - " + skipReason);
                    stepResults.put(1, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 1 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 1 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 1: ts-admin-route-service POST /api/v1/adminrouteservice/adminroute (expect 200): " + stepException.getMessage());
                stepResults.put(1, false);
            }
        }

        // Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-station-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/stationservice/stations/idlist");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-station-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/stationservice/stations/idlist\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody2 = "[\"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\", \"[\\\"Chicago O'Hare Station\\\", \\\"San Francisco Caltrain Depot\\\", \\\"Boston South Station\\\", \\\"Seattle King Street Station\\\", \\\"Washington Union Station\\\"]\"]";
                        req = req.body(requestBody2);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody2);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse2 = req.when().post("/api/v1/stationservice/stations/idlist")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(2, true);
                        System.out.println("âœ… Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse2.getBody().asString();
                            int actualStatus = stepResponse2.getStatusCode();
                            long responseTime = stepResponse2.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(2, false);
                        System.out.println("âŒ Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200) - " + skipReason);
                    stepResults.put(2, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 2 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 2 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 2: ts-station-service POST /api/v1/stationservice/stations/idlist (expect 200): " + stepException.getMessage());
                stepResults.put(2, false);
            }
        }

        // Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)
        // ğŸ”¥ ALWAYS create Allure step - execution decision happens INSIDE
        try {
            Allure.step("Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200)", () -> {
                Allure.parameter("ğŸ¢ Service", "ts-route-service");
                Allure.parameter("ğŸ“¡ HTTP Method", "POST");
                Allure.parameter("ğŸ”— Endpoint", "/api/v1/routeservice/routes");
                Allure.parameter("ğŸ¯ Expected Status", 200);
                Allure.parameter("ğŸ”— Dependency Type", "INDEPENDENT (can execute regardless of other step results)");
                Allure.description("ğŸ¯ **Testing**: ts-route-service\n" +
                                 "ğŸ“¡ **Method**: POST\n" +
                                 "ğŸ”— **Path**: /api/v1/routeservice/routes\n" +
                                 "ğŸ¯ **Expected**: 200\n" +
                                 "ğŸ”— **Dependencies**: INDEPENDENT (can execute regardless of other step results)");
                
                // Execution decision analysis - determine if step should execute
                boolean shouldSkip = false;
                String skipReason = "";
                String skipCategory = "";
                
                // Check authentication dependency
                if (!loginSucceeded.get()) {
                    shouldSkip = true;
                    skipReason = "Authentication failed - cannot proceed with authenticated API calls";
                    skipCategory = "ğŸ” AUTH_FAILED";
                }
                
                // Add execution decision as parameter
                if (shouldSkip) {
                    Allure.parameter("ğŸš¦ Execution Decision", "â­ï¸ SKIP - " + skipCategory);
                    Allure.parameter("â­ï¸ Skip Reason", skipReason);
                } else {
                    Allure.parameter("ğŸš¦ Execution Decision", "â–¶ï¸ EXECUTE - All dependencies satisfied");
                }
                
                if (!shouldSkip) {
                    System.out.println("â–¶ï¸ EXECUTING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) (dependency analysis passed)");
                    try {
                        RequestSpecification req = RestAssured.given();
                        // ğŸ”¥ FIX: Set Content-Type to application/json for requests with bodies
                        req = req.contentType("application/json");
                        String requestBody3 = "{\"distanceList\":\"1.\",\"endStation\":\"Central Station\",\"id\":\"0b23bd3e-876a-4af3-b920-c50a90c90b04\",\"startStation\":\"wuxi\",\"stationList\":\"jiaxingnan\"}";
                        req = req.body(requestBody3);
                        
                        // Add request details as single attachment
                        Allure.addAttachment("ğŸ“¤ Request Body", "application/json", requestBody3);
                        if (loginSucceeded.get()) {
                            req = req.header("Authorization", jwtType + " " + jwt);
                        }
                        Response stepResponse3 = req.when().post("/api/v1/routeservice/routes")
                               .then().log().ifValidationFails()
                               .statusCode(200)
                               .extract().response();
                        
                        stepResults.put(3, true);
                        System.out.println("âœ… Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - SUCCESS");
                        // âœ… SUCCESS: Clean success reporting without duplication
                        try {
                            String responseBody = stepResponse3.getBody().asString();
                            int actualStatus = stepResponse3.getStatusCode();
                            long responseTime = stepResponse3.getTime();
                            
                            // Single success status parameter
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (" + actualStatus + " in " + responseTime + "ms)");
                            
                            // Single response attachment (avoid duplication)
                            Allure.addAttachment("ğŸ“¥ Response (" + actualStatus + ")", "application/json", responseBody);
                        } catch (Exception e) {
                            Allure.parameter("ğŸ¯ Result", "âœ… SUCCESS (response capture failed)");
                        }
                    } catch (Throwable t) {
                        stepResults.put(3, false);
                        System.out.println("âŒ Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - FAILED: " + t.getMessage());
                        
                        // âŒ FAILURE: Clean failure reporting with proper Allure status
                        String errorType = t.getClass().getSimpleName();
                        if (t instanceof java.net.ConnectException) {
                            errorType = "Connection Failed";
                        } else if (t instanceof AssertionError) {
                            errorType = "Status Code Mismatch";
                        } else if (t instanceof java.net.SocketTimeoutException) {
                            errorType = "Request Timeout";
                        }
                        
                        // Single failure status parameter
                        Allure.parameter("ğŸ¯ Result", "âŒ FAILED (" + errorType + ")");
                        
                        // Single error attachment
                        Allure.addAttachment("ğŸ’¥ Error Details", "text/plain", "Error: " + errorType + "\nMessage: " + t.getMessage());
                        
                        // ğŸ”¥ CRITICAL: Throw exception to mark step as FAILED (red arrow) in Allure
                        throw new RuntimeException("Step failed: " + errorType, t);
                    }
                } else {
                    // â­ï¸ SKIP: Clean skip reporting with proper Allure status
                    System.out.println("â­ï¸ SKIPPING: Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200) - " + skipReason);
                    stepResults.put(3, false);
                    
                    // Single skip status parameter
                    Allure.parameter("ğŸ¯ Result", "â­ï¸ SKIPPED (" + skipCategory.replaceAll("ğŸ” |ğŸ“Š |ğŸ”„ ", "") + ")");
                    
                    // Single skip reason attachment
                    Allure.addAttachment("â­ï¸ Skip Details", "text/plain", "Reason: " + skipReason);
                    
                    // ğŸ”¥ CRITICAL: Throw Assumption exception to mark step as SKIPPED (yellow arrow) in Allure
                    throw new org.junit.AssumptionViolatedException("Step skipped: " + skipReason);
                }
            });
        } catch (Exception stepException) {
            // Step wrapper exception handling - maintain execution flow
            if (stepException instanceof RuntimeException && stepException.getMessage().startsWith("Step failed:")) {
                // This is a failed step - already handled, just continue
                System.out.println("Step 3 marked as FAILED in Allure");
            } else if (stepException instanceof org.junit.AssumptionViolatedException) {
                // This is a skipped step - already handled, just continue
                System.out.println("Step 3 marked as SKIPPED in Allure");
            } else {
                // Unexpected wrapper failure
                System.out.println("âš ï¸ Step wrapper failed for Step 3: ts-route-service POST /api/v1/routeservice/routes (expect 200): " + stepException.getMessage());
                stepResults.put(3, false);
            }
        }

        // Evaluate scenario result with comprehensive reporting
        long successfulSteps = stepResults.values().stream().filter(result -> result).count();
        long failedSteps = stepResults.values().stream().filter(result -> !result).count();
        long totalSteps = stepResults.size();
        
        // Add clean test summary - no duplicate content
        String overallResult;
        String severity;
        if (!loginSucceeded.get()) {
            overallResult = "âŒ AUTHENTICATION FAILED";
            severity = "critical";
        } else if (failedSteps == 0) {
            overallResult = "âœ… ALL STEPS PASSED";
            severity = "normal";
        } else if (successfulSteps > 0) {
            overallResult = "âš ï¸ PARTIAL FAILURE";
            severity = "major";
        } else {
            overallResult = "âŒ ALL STEPS FAILED";
            severity = "critical";
        }
        
        // Single summary parameter with all key info
        Allure.parameter("ğŸ“Š Scenario Result", overallResult + " (" + successfulSteps + "/" + totalSteps + " steps)");
        
        // Add clean categorization
        Allure.label("severity", severity);
        Allure.label("feature", "Microservice Workflow");
        Allure.label("story", "test_POST_1_10");
        Allure.description("Microservice test scenario with " + totalSteps + " steps.");
        
        System.out.println("=== SCENARIO RESULT ===");
        System.out.println("Scenario: test_POST_1_10");
        System.out.println("Total Steps: " + totalSteps);
        System.out.println("Successful: " + successfulSteps);
        System.out.println("Failed: " + failedSteps);
        System.out.println("Login Status: " + (loginSucceeded.get() ? "SUCCESS" : "FAILED"));
        
        // IMPROVED: Test fails if ANY step fails or login fails (not just when ALL fail)
        if (!loginSucceeded.get()) {
            fail("Scenario FAILED: Authentication failed - cannot proceed with API calls");
        } else if (failedSteps > 0) {
            fail("Scenario FAILED: " + failedSteps + " out of " + totalSteps + " steps failed. " +
                 "In microservice testing, all workflow steps must succeed for end-to-end validation.");
        } else if (successfulSteps == 0) {
            fail("Scenario FAILED: No steps executed successfully - check service availability");
        } else {
            System.out.println("ğŸ‰ Scenario PASSED: All " + totalSteps + " steps completed successfully");
        }
    }

}
